
AIDE:
column CL_R FOR A8
TRU


a)

Select DEPTNO, ENAME, SAL, RANK() OVER (PARTITION BY DEPTNO ORDER BY SAL DESC) as RANG 
From EMP 
Where DEPTNO in (10,30);


b)
Select DEPTNO, ENAME, SAL, DENSE_RANK() OVER (PARTITION BY DEPTNO ORDER BY SAL DESC) as RANG 
From EMP 
Where DEPTNO in (10,30);

c)
Select DISTINCT DEPTNO, SAL, DENSE_RANK() OVER (PARTITION BY DEPTNO ORDER BY SAL DESC) as RANG 
From EMP 
Where DEPTNO in (10,20)
ORDER BY DEPTNO ASC, SAL DESC;

OU 

Select DEPTNO, SAL, DENSE_RANK() OVER (PARTITION BY DEPTNO ORDER BY SAL DESC) as RANG 
From EMP 
Where DEPTNO in (10,20)
GROUP BY DEPTNO, SAL;

d)
Select Job, sum(SAL) as TOT_SAL_JOB
FROM EMP GROUP BY Job

Select distinct Job, sum(SAL) OVER (PARTITION BY Job) as TOT_SAL_JOB
FROM EMP;

e)
-- Partition by conserve le nombre de ligne mais groupe la donnée de over, Group by supprime les doublons (réuni les lignes).

f)

Select EMP.Deptno, Job, sum(SAL)
FROM EMP
GROUP BY ROLLUP (EMP.Deptno, job);


g)

Select NVL(TO_CHAR(EMP.Deptno),'TousDep') as Deptno, NVL(TO_CHAR(Job),'TousEmployes') as Job, sum(SAL)
FROM EMP
GROUP BY ROLLUP (EMP.Deptno, job);


TEMPS      (TID, annee, trimestre, mois, jour)
CLIENTS   (CL_ID,CL_NAME,CL_CITY, CL_R, CL_STATE)
PRODUITS  (PID, PNAME, CATEGORY, SUBCAT)
VENTES    (TID, PID, CID, QTE, PU)


EXERCICE 2: OLAP/ROLAP sous Oracle


1.

Select annee, CL_R, CATEGORY, AVG(PU*QTE) as CA_MOYEN
FROM VENTES V
JOIN TEMPS T ON V.TID=T.TID
JOIN CLIENTS C  ON C.CL_ID=V.CID
JOIN PRODUITS P ON P.PID=V.PID
WHERE annee in (2009,2010)
GROUP BY GROUPING SETS((annee, CL_R, CATEGORY),(annee,CL_R),(annee),());



2.

Select annee, CL_R, CATEGORY, AVG(PU*QTE) as CA_MOYEN
FROM VENTES V
JOIN TEMPS T ON V.TID=T.TID
JOIN CLIENTS C  ON C.CL_ID=V.CID
JOIN PRODUITS P ON P.PID=V.PID
WHERE annee in (2009,2010)
GROUP BY CUBE (annee, CL_R, CATEGORY);

3.

PRODUITS  (PID, PNAME, CATEGORY, SUBCAT)
VENTES    (TID, PID, CID, QTE, PU)



-- PRESQUE BON
Select annee, CATEGORY, PNAME, RANK() OVER(PARTITION BY annee,category ORDER BY SUM(QTE*PU) desc) as RANG
FROM VENTES V
JOIN TEMPS T ON V.TID=T.TID
JOIN CLIENTS C  ON C.CL_ID=V.CID
JOIN PRODUITS P ON P.PID=V.PID
GROUP BY annee, CATEGORY, PNAME
ORDER BY annee asc



Select annee, CATEGORY, PNAME, RANK() OVER(PARTITION BY annee,category ORDER BY SUM(QTE*PU) desc) as RANG
FROM VENTES V
JOIN TEMPS T ON V.TID=T.TID
JOIN CLIENTS C  ON C.CL_ID=V.CID
JOIN PRODUITS P ON P.PID=V.PID
WHERE RANG = 1 -- non possible car where avant select
GROUP BY annee, CATEGORY, PNAME
ORDER BY annee asc



--OUIIIIIIIIIIIIII
Select annee, CATEGORY, PNAME
FROM (select T2.annee, P2.CATEGORY, P2.PNAME, RANK() OVER(PARTITION BY annee,P2.category ORDER BY SUM(QTE*PU) desc) as RANG
  FROM VENTES V2
  JOIN TEMPS T2 ON V2.TID=T2.TID
  JOIN CLIENTS C2  ON C2.CL_ID=V2.CID
  JOIN PRODUITS P2 ON P2.PID=V2.PID
  GROUP BY annee, P2.CATEGORY, P2.PNAME
  ) TMP
WHERE TMP.RANG = 1
GROUP BY annee, CATEGORY, PNAME
ORDER BY annee asc




select max (avg_salary)
from (select worker_id, avg(salary) AS avg_salary
  from workers
  group by worker_id);




SELECT PNAME
FROM VENTES V
JOIN TEMPS T ON V.TID=T.TID
JOIN CLIENTS C  ON C.CL_ID=V.CID
JOIN PRODUITS P ON P.PID=V.PID
WHERE ANNEE = 2009
GROUP BY ANNEE, CATEGORY
HAVING(AVG(QTE*PU) )













